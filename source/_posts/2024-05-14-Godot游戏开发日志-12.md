---
title: 14
tags:
  - null
categories:
  - null
abbrlink: a630e1f8
date: 2024-05-14 23:13:56
description:
---

### 1 复用节点stats节点

创建node2D节点stats，负责管理小怪属性

```
extends Node2D

@export var max_health:int = 1
@onready var health  = max_health
```

bat脚本中应用伤害

```
func _on_hurtbox_area_entered(area):
	stats.health -= 1
	if stats.health <= 0:
		queue_free()
```

为了更好的代码结构，加入信号,向下调用，向上信号，这样对象独立性更高，切记！

stats.gd

```
extends Node2D

@export var max_health:int = 1
@onready var health  = max_health:set=set_health

signal no_health

#health被设置时，set函数会被自动调用
func set_health(value):
	health = value
	if health <= 0:
		emit_signal("no_health")
```

bat.gd中的方法

```
func _on_hurtbox_area_entered(area):
	stats.health -= 1
	#if stats.health <= 0:
		#queue_free()
		
	#knockback_vector后面定义，测试用随便一个方向，比如右方向替换
	knockback = area.knockback_vector *120
```

再优化一下，不要再伤害-1了，damage变量管理伤害，在hitbox定义damage

```
extends Area2D

@export var damage = 1

```

sworldHitbox里通过继承hitbox，继承damage

```
extends "res://Effects/Hitbox&Hurtbox/hitbox.gd"

var knockback_vector = Vector2.ZERO

```

然后在bat里面使用damage

```
func _on_hurtbox_area_entered(area):
	stats.health -= area.damage
```

