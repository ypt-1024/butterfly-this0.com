---
title: 14
tags:
  - null
categories:
  - null
abbrlink: a630e1f8
date: 2024-05-17 01:21:41
description:
---

1 添加击中动画

2 给hurtbox 通用的effect的脚本，预加载和实例化

```
extends Area2D

const HIT_EFFECT = preload("res://Effects/hit_effect.tscn")


func _on_area_entered(area: Area2D) -> void:
	var effect = HIT_EFFECT.instantiate()
	
	#不使用get_parent().add_child()实例化，因为parent会被free（）
	var main = get_tree().current_scene
	
	main.add_child(effect)
	effect.global_position = global_position

```

但问题出现了，草也有这个摧毁动画

使用特效开关按钮解决

```
extends Area2D

@export var show_hit:bool = true

const HIT_EFFECT = preload("res://Effects/hit_effect.tscn")

func _on_area_entered(area: Area2D) -> void:
	if show_hit:		
		var effect = HIT_EFFECT.instantiate()
		
		#不使用get_parent().add_child()实例化，因为parent会被free（）
		var main = get_tree().current_scene
		
		main.add_child(effect)
		effect.global_position = global_position

```

### 3 蝙蝠状态

蝙蝠状态机

```
enum{
	IDLE,
	WANDER,
	CHASE
}
```

初始状态为IDLE

```
var state = IDLE
```

在状态机的IDLE里重新设置速度

----------



1 新建Area2d节点，命名为PlayerDetectionZone

添加碰撞形状，可以导出碰撞形状，做成一个工具

关联脚本，检测玩家进入

```
extends Area2D

var player=null

#能否看到玩家
func can_see_player():
	return player != null

#检测玩家进入
func _on_body_entered(body):
	player=body

func _on_body_exited(body):
	player=null

```

怎样确保进入的是玩家？碰撞层

mask只勾选play，这样只和玩家碰撞

![image-20240606050701248](https://blog-resources.this0.com/image/202406060507278.png?x-oss-process=style/this0-blog)

4 侦测节点

打开Bat，引用侦测区域，新建碰撞形状

![image-20240606051306388](https://blog-resources.this0.com/image/202406060513667.png?x-oss-process=style/this0-blog)

### 调整侦测层级

![image-20240606062329298](https://blog-resources.this0.com/image/202406060623330.png?x-oss-process=style/this0-blog)


​			
​	#调整追赶中的方向		

	CHASE:
			......
		else :
					#避免离开时追赶方向停不下来
					state = IDLE
		
				#调整追赶中的方向
				sprite.flip_h = velocity.x < 0
